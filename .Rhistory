})
means
})
ttest_ORNP_df
library(dplyr)
library(tibble)
scale_ranges <- tribble(
~prefix,   ~xmin, ~xmax,
"OPE",     1, 5,
"CON",     1, 5,
"EXT",     1, 5,
"AG",      1, 5,
"NEUR",    1, 5,
"MACH",    1, 5,
"NAR",     1, 5,
"PSY",     1, 5,
"PCS",     1, 5,
"RWA",     1, 5,
"SSDO",    1, 8,
"SRS",     1, 3,
"IITC.C",  1, 6,
"IITC.D",  1, 6,
"ALLBUS",  1, 10
)
ttest_ORP_df <- ttest_ORP_df %>%
left_join(scale_ranges, by = "prefix")
ttest_ORNP_df <- ttest_ORNP_df %>%
left_join(scale_ranges, by = "prefix")
ttest_ORP_df$comparison <- "SR_ORP"
ttest_ORNP_df$comparison <- "SR_ORNP"
ttest_combined_df <- bind_rows(ttest_ORP_df, ttest_ORNP_df)
ttest_combined_df
library(ggplot2)
library(dplyr)
library(stringr)
plot_prefix <- function(prefix,
df,
pvals,
cohensds,
title = NULL,
xtitle = NULL,
condition_labels = c("Non-Ideal Politician", "Ideal Politician", "Self"),
condition_order = c("ORNP", "ORP", "SR"),
print_data = FALSE) {
# ─────────────────────────────────────
# 1. Filter data for this prefix
# ─────────────────────────────────────
d <- df %>% filter(prefix == !!prefix)
if (nrow(d) == 0) stop(paste("No data found for", prefix))
# Optional: print the subset used for plotting
if (print_data) {
cat("\n──────────────────────────────\n")
cat("Data for prefix:", prefix, "\n")
print(d)
cat("──────────────────────────────\n\n")
}
# ─────────────────────────────────────
# 2. Full theoretical scale range
# ─────────────────────────────────────
xmin <- unique(d$xmin)
xmax <- unique(d$xmax)
# ─────────────────────────────────────
# 3. Extract p-values for both comparisons
# ─────────────────────────────────────
p_orp <- pvals %>%
filter(prefix == !!prefix, comparison == "SR_ORP") %>%
pull(p) %>%
unique()
p_ornp <- pvals %>%
filter(prefix == !!prefix, comparison == "SR_ORNP") %>%
pull(p) %>%
unique()
d_orp <- cohensds %>%
filter(prefix == !!prefix, comparison == "SR_ORP") %>%
pull(d) %>%
unique()
d_ornp <- cohensds %>%
filter(prefix == !!prefix, comparison == "SR_ORNP") %>%
pull(d) %>%
unique()
# ─────────────────────────────────────
# 4. Identify conditions (SR, ORP, ORNP)
# ─────────────────────────────────────
d <- d %>%
mutate(cond_short = case_when(
str_detect(condition, "_SR$")   ~ "SR",
str_detect(condition, "_ORP$")  ~ "ORP",
str_detect(condition, "_ORNP$") ~ "ORNP",
TRUE ~ condition
))
# ─────────────────────────────────────
# 5. Handle empty or unnamed condition_labels
# ─────────────────────────────────────
if (is.null(condition_labels) || length(condition_labels) == 0) {
message("No condition_labels provided; using default SR/ORP/ORNP labels.")
condition_labels <- c(SR = "SR", ORP = "ORP", ORNP = "ORNP")
}
# If labels are unnamed, assume they follow condition_order
if (is.null(names(condition_labels))) {
condition_labels <- setNames(
condition_labels,
condition_order[seq_along(condition_labels)]
)
}
# Keep only valid mappings (SR, ORP, ORNP)
valid_names <- intersect(names(condition_labels), c("SR", "ORP", "ORNP"))
label_map <- condition_labels[valid_names]
# Determine which conditions are present
present <- intersect(condition_order, unique(d$cond_short))
levels_vec <- unname(label_map[present])
# Map cond_short → label and enforce factor order
d <- d %>%
mutate(
label = unname(label_map[cond_short]),
label = ifelse(is.na(label), cond_short, label),
label = factor(label, levels = levels_vec, ordered = TRUE)
)
# ─────────────────────────────────────
# 6. Assign colors (SR + ORNP black, ORP gray)
# ─────────────────────────────────────
d <- d %>%
mutate(color = case_when(
cond_short == "SR" ~ "black",
cond_short == "ORP" ~ "gray60",
cond_short == "ORNP" ~ "black",
TRUE ~ "black"
))
# ─────────────────────────────────────
# 7. Subtitle text (p-values)
# ─────────────────────────────────────
subtitle_text <- paste(
if (length(p_orp) > 0)
paste0("S–IP: p = ", formatC(p_orp, format = "f", digits = 3), ", d = ", formatC(abs(d_orp), format = "f", digits = 2), "\n"),
if (length(p_ornp) > 0)
paste0("S–NIP: p = ", formatC(p_ornp, format = "f", digits = 3), ", d = ", formatC(abs(d_ornp), format = "f", digits = 2)),
collapse = "    |    "
)
# ─────────────────────────────────────
# 8. Create ggplot
# ─────────────────────────────────────
ggplot(d, aes(y = label, x = mean)) +
geom_point(aes(color = color), size = 3, show.legend = FALSE) +
geom_errorbarh(aes(xmin = ci_low, xmax = ci_high, color = color),
height = 0.15, show.legend = FALSE) +
scale_color_identity() +
coord_cartesian(xlim = c(xmin, xmax), expand = FALSE) +
scale_x_continuous(breaks = seq(xmin, xmax, 1)) +
labs(
title = title,
subtitle = subtitle_text,
x = xtitle,
y = ""
) +
theme_minimal(base_size = 24) +
theme(
panel.grid.minor = element_blank(),
panel.grid.major.y = element_blank(),
plot.title = element_text(face = "bold")
)
}
pvals <- ttest_combined_df %>%
select(prefix, comparison, p) %>%
distinct()
cohensds <- ttest_combined_df %>%
select(prefix, comparison, d) %>%
distinct()
ttest_combined_df$comparison
plot_prefix(
prefix = "ALLBUS",
df = ttest_combined_df,
pvals = pvals,
cohensds = cohensds,
xtitle = "Political Orientation"
)
ttest_combined_df
xtitles <- c(
OPE     = "Openness to Experience",
CON     = "Conscientiousness",
EXT     = "Extraversion",
AG      = "Agreeableness",
NEUR    = "Neuroticism",
MACH    = "Machiavellianism",
NAR     = "Narcissism",
PSY     = "Psychopathy",
PCS     = "Political Cynicism",
SSDO    = "Social Dominance Orientation",
SRS     = "Rebelliousness",
IITC.C  = "Calculating IIT",
IITC.D  = "Dominating IIT",
ALLBUS  = "Political Orientation"
)
library(purrr)
library(purrr)
plot_list <- map(names(xtitles), function(pfx) {
plot_prefix(
prefix = pfx,
df = ttest_combined_df,
pvals = pvals,
cohensds = cohensds,
title = xtitles[[pfx]],
)
}) %>%
set_names(names(xtitles))
plot_list
wrap_plots(plotlist = plot_list[1:8], ncol = 2, heights = rep(0.7, length(plot_list)))
wrap_plots(plotlist = plot_list[1:8], ncol = 2, heights = rep(0.7, length(plot_list)))
library(dplyr)
library(purrr)
ttest_ORP_df <- map_dfr(names(ttests_ORP), function(prefix) {
res <- ttests_ORP[[prefix]]
# Extract weighted means
#mean_x <- res$additional["Mean.x"]
#mean_y <- res$additional["Mean.y"]
mean_diff <- res$estimate
se <- res$stderr
#diff <- res$additional["Difference"]
tval <- res$statistic
df <- res
pval <- res$p.value
# Compute 95% CI for the difference (optional)
ci_low <- res$conf.int[[1]]
ci_high <- res$conf.int[[2]]
# Also compute weighted SE and CI for each group mean from data directly
vars <- paste0(prefix, "_", c("SR", "ORP"))
dat <- data[, c(vars)]
means <- map_dfr(vars, function(v) {
x <- dat[[v]]
mean <- mean(x)
var <- var(x)
sd <- sd(x)
se <- sd/sqrt(length(na.omit(x)))
d <- tval/sqrt(length(na.omit(x)))
tibble(
prefix = prefix,
condition = v,
mean = mean,
se = se,
ci_low = mean - qt(0.975, (length(x)-1)) * se,
ci_high = mean + qt(0.975, (length(x)-1)) * se,
p = pval,
d = d
)
})
means
})
ttest_ORP_df
ttest_ORNP_df <- map_dfr(names(ttests_ORNP), function(prefix) {
res <- ttests_ORNP[[prefix]]
# Extract weighted means
#mean_x <- res$additional["Mean.x"]
#mean_y <- res$additional["Mean.y"]
mean_diff <- res$estimate
se <- res$stderr
#diff <- res$additional["Difference"]
tval <- res$statistic
df <- res
pval <- res$p.value
# Compute 95% CI for the difference (optional)
ci_low <- res$conf.int[[1]]
ci_high <- res$conf.int[[2]]
# Also compute weighted SE and CI for each group mean from data directly
vars <- paste0(prefix, "_", c("SR", "ORNP"))
dat <- data[, c(vars)]
means <- map_dfr(vars, function(v) {
x <- dat[[v]]
mean <- mean(x)
var <- var(x)
sd <- sd(x)
se <- sd/sqrt(length(na.omit(x)))
d <- tval/sqrt(length(na.omit(x)))
tibble(
prefix = prefix,
condition = v,
mean = mean,
se = se,
ci_low = mean - qt(0.975, (length(x)-1)) * se,
ci_high = mean + qt(0.975, (length(x)-1)) * se,
p = pval,
d = d
)
})
means
})
ttest_ORNP_df
library(dplyr)
library(tibble)
scale_ranges <- tribble(
~prefix,   ~xmin, ~xmax,
"OPE",     1, 5,
"CON",     1, 5,
"EXT",     1, 5,
"AG",      1, 5,
"NEUR",    1, 5,
"MACH",    1, 5,
"NAR",     1, 5,
"PSY",     1, 5,
"PCS",     1, 5,
"RWA",     1, 5,
"SSDO",    1, 8,
"SRS",     1, 3,
"IITC.C",  1, 6,
"IITC.D",  1, 6,
"ALLBUS",  1, 10
)
ttest_ORP_df <- ttest_ORP_df %>%
left_join(scale_ranges, by = "prefix")
ttest_ORNP_df <- ttest_ORNP_df %>%
left_join(scale_ranges, by = "prefix")
ttest_ORP_df$comparison <- "SR_ORP"
ttest_ORNP_df$comparison <- "SR_ORNP"
ttest_combined_df <- bind_rows(ttest_ORP_df, ttest_ORNP_df)
ttest_combined_df
library(ggplot2)
library(dplyr)
library(stringr)
plot_prefix <- function(prefix,
df,
pvals,
cohensds,
title = NULL,
xtitle = NULL,
condition_labels = c("Non-Ideal Politician", "Ideal Politician", "Self"),
condition_order = c("ORNP", "ORP", "SR"),
print_data = FALSE) {
# ─────────────────────────────────────
# 1. Filter data for this prefix
# ─────────────────────────────────────
d <- df %>% filter(prefix == !!prefix)
if (nrow(d) == 0) stop(paste("No data found for", prefix))
# Optional: print the subset used for plotting
if (print_data) {
cat("\n──────────────────────────────\n")
cat("Data for prefix:", prefix, "\n")
print(d)
cat("──────────────────────────────\n\n")
}
# ─────────────────────────────────────
# 2. Full theoretical scale range
# ─────────────────────────────────────
xmin <- unique(d$xmin)
xmax <- unique(d$xmax)
# ─────────────────────────────────────
# 3. Extract p-values for both comparisons
# ─────────────────────────────────────
p_orp <- pvals %>%
filter(prefix == !!prefix, comparison == "SR_ORP") %>%
pull(p) %>%
unique()
p_ornp <- pvals %>%
filter(prefix == !!prefix, comparison == "SR_ORNP") %>%
pull(p) %>%
unique()
d_orp <- cohensds %>%
filter(prefix == !!prefix, comparison == "SR_ORP") %>%
pull(d) %>%
unique()
d_ornp <- cohensds %>%
filter(prefix == !!prefix, comparison == "SR_ORNP") %>%
pull(d) %>%
unique()
# ─────────────────────────────────────
# 4. Identify conditions (SR, ORP, ORNP)
# ─────────────────────────────────────
d <- d %>%
mutate(cond_short = case_when(
str_detect(condition, "_SR$")   ~ "SR",
str_detect(condition, "_ORP$")  ~ "ORP",
str_detect(condition, "_ORNP$") ~ "ORNP",
TRUE ~ condition
))
# ─────────────────────────────────────
# 5. Handle empty or unnamed condition_labels
# ─────────────────────────────────────
if (is.null(condition_labels) || length(condition_labels) == 0) {
message("No condition_labels provided; using default SR/ORP/ORNP labels.")
condition_labels <- c(SR = "SR", ORP = "ORP", ORNP = "ORNP")
}
# If labels are unnamed, assume they follow condition_order
if (is.null(names(condition_labels))) {
condition_labels <- setNames(
condition_labels,
condition_order[seq_along(condition_labels)]
)
}
# Keep only valid mappings (SR, ORP, ORNP)
valid_names <- intersect(names(condition_labels), c("SR", "ORP", "ORNP"))
label_map <- condition_labels[valid_names]
# Determine which conditions are present
present <- intersect(condition_order, unique(d$cond_short))
levels_vec <- unname(label_map[present])
# Map cond_short → label and enforce factor order
d <- d %>%
mutate(
label = unname(label_map[cond_short]),
label = ifelse(is.na(label), cond_short, label),
label = factor(label, levels = levels_vec, ordered = TRUE)
)
# ─────────────────────────────────────
# 6. Assign colors (SR + ORNP black, ORP gray)
# ─────────────────────────────────────
d <- d %>%
mutate(color = case_when(
cond_short == "SR" ~ "black",
cond_short == "ORP" ~ "black",
cond_short == "ORNP" ~ "black",
TRUE ~ "black"
))
# ─────────────────────────────────────
# 7. Subtitle text (p-values)
# ─────────────────────────────────────
subtitle_text <- paste(
if (length(p_orp) > 0)
paste0("S–IP: p = ", formatC(p_orp, format = "f", digits = 3), ", d = ", formatC(abs(d_orp), format = "f", digits = 2), "\n"),
if (length(p_ornp) > 0)
paste0("S–NIP: p = ", formatC(p_ornp, format = "f", digits = 3), ", d = ", formatC(abs(d_ornp), format = "f", digits = 2)),
collapse = "    |    "
)
# ─────────────────────────────────────
# 8. Create ggplot
# ─────────────────────────────────────
ggplot(d, aes(y = label, x = mean)) +
geom_point(aes(color = color), size = 3, show.legend = FALSE) +
geom_errorbarh(aes(xmin = ci_low, xmax = ci_high, color = color),
height = 0.15, show.legend = FALSE) +
scale_color_identity() +
coord_cartesian(xlim = c(xmin, xmax), expand = FALSE) +
scale_x_continuous(breaks = seq(xmin, xmax, 1)) +
labs(
title = title,
subtitle = subtitle_text,
x = xtitle,
y = ""
) +
theme_minimal(base_size = 24) +
theme(
panel.grid.minor = element_blank(),
panel.grid.major.y = element_blank(),
plot.title = element_text(face = "bold")
)
}
pvals <- ttest_combined_df %>%
select(prefix, comparison, p) %>%
distinct()
cohensds <- ttest_combined_df %>%
select(prefix, comparison, d) %>%
distinct()
ttest_combined_df$comparison
plot_prefix(
prefix = "ALLBUS",
df = ttest_combined_df,
pvals = pvals,
cohensds = cohensds,
xtitle = "Political Orientation"
)
ttest_combined_df
xtitles <- c(
OPE     = "Openness to Experience",
CON     = "Conscientiousness",
EXT     = "Extraversion",
AG      = "Agreeableness",
NEUR    = "Neuroticism",
MACH    = "Machiavellianism",
NAR     = "Narcissism",
PSY     = "Psychopathy",
PCS     = "Political Cynicism",
SSDO    = "Social Dominance Orientation",
SRS     = "Rebelliousness",
IITC.C  = "Calculating IIT",
IITC.D  = "Dominating IIT",
ALLBUS  = "Political Orientation"
)
library(purrr)
plot_list <- map(names(xtitles), function(pfx) {
plot_prefix(
prefix = pfx,
df = ttest_combined_df,
pvals = pvals,
cohensds = cohensds,
title = xtitles[[pfx]],
)
}) %>%
set_names(names(xtitles))
plot_list
library(patchwork)
(plot_list$OPE | plot_list$CON | plot_list$EXT) /
(plot_list$AG | plot_list$NEUR)
ttest_combined_df
wrap_plots(plotlist = plot_list[1:8], ncol = 2, heights = rep(0.7, length(plot_list)))
wrap_plots(plotlist = plot_list[1:8], ncol = 2, heights = rep(0.7, length(plot_list)))
suffixes <- c("SR", "ORP")
suffixes <- c("SR", "ORP")
cors_ORP <- lapply(prefixes, function(prefix) {
strings <- sapply(suffixes, function(suffix) {
string <- paste0(prefix, "_", suffix)
return(string)
})
data <- data[, c(strings)]
ezpz::cor.ezpz(data, cis = TRUE)
})
cors_ORP
remotes::install_github("JanPalnau/ezpz")
remotes::install_github("JanPalnau/ezpz")
remotes::install_github("JanPalnau/ezpz")
remotes::install_github("JanPalnau/ezpz")
library(ezpz)
remove.packages("ezpz")
remotes::install_github("JanPalnau/ezpz")
remove.packages("ezpz")
setwd("~/Documents/GitHub/ezpz/man")
setwd("~/Documents/GitHub/ezpz")
devtools::document()
devtools::install(clean = TRUE)
